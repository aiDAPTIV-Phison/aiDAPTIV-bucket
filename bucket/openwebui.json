{
  "version": "v0.0.2",
  "description": "Open WebUI is an extensible, feature-rich, and user-friendly self-hosted AI platform designed to operate entirely offline. It supports various LLM runners like Ollama and OpenAI-compatible APIs, with built-in inference engine for RAG, making it a powerful AI deployment solution.",
  "homepage": "https://github.com/aiDAPTIV-Phison/aiDAPTIV-Integration-open-webui",
  "url": ["https://github.com/aiDAPTIV-Phison/aiDAPTIV-bucket/raw/refs/heads/main/open_webui/start.ps1",
          "https://github.com/aiDAPTIV-Phison/aiDAPTIV-bucket/raw/refs/heads/main/open_webui/stop.ps1",
          "https://github.com/aiDAPTIV-Phison/aiDAPTIV-bucket/raw/refs/heads/main/open_webui/config.txt",
          "http://192.168.54.46:18301/open-webui.zip"],
  "depends": [
    "python311"
  ],
  "installer": {
    "script": [
      "# 1. Extract open-webui.zip (corresponding to setup_and_run.bat 27-54)",
      "# Scoop automatically extracts ZIP files, so we need to detect the actual structure",
      "$openWebuiDir = Join-Path $dir 'open-webui'",
      "$zipDest = Join-Path $dir 'open-webui.zip'",
      "",
      "# Check and install uv (corresponding to setup_and_run.bat 229-254)",
      "Write-Host '[INFO] Checking for uv...'",
      "$uvCheck = Get-Command uv -ErrorAction SilentlyContinue",
      "if (-not $uvCheck) {",
      "    Write-Host '[INFO] uv not found, installing uv...'",
      "    python -m pip install uv",
      "    if ($LASTEXITCODE -ne 0) {",
      "        Write-Error 'Failed to install uv'",
      "        exit 1",
      "    }",
      "    Write-Host '[INFO] uv installed successfully'",
      "} else {",
      "    Write-Host '[INFO] uv is already installed'",
      "}",
      "",
      "# 2. Create venv for backend (corresponding to setup_and_run.bat 256-307)",
      "Write-Host '[INFO] Setting up backend virtual environment...'",
      "$backendPath = Join-Path $dir 'backend'",
      "$backendVenv = Join-Path $backendPath 'venv_open_webui'",
      "",
      "if (-not (Test-Path $backendVenv)) {",
      "    Write-Host '[INFO] Virtual environment not found, creating new one...'",
      "    python311 -m venv $backendVenv",
      "    if ($LASTEXITCODE -ne 0) {",
      "        Write-Error 'Failed to create venv_open_webui'",
      "        exit 1",
      "    }",
      "    Write-Host '[INFO] Virtual environment created'",
      "} else {",
      "    Write-Host '[INFO] Virtual environment already exists, will update dependencies'",
      "}",
      "",
      "Write-Host '[INFO] Checking and installing backend requirements...'",
      "$backendActivate = Join-Path $backendVenv 'Scripts\\Activate.ps1'",
      "& $backendActivate",
      "",
      "$requirementsTxt = Join-Path $backendPath 'requirements.txt'",
      "",
      "if (Test-Path $requirementsTxt) {",
      "    Write-Host '[INFO] Installing from requirements.txt...'",
      "    pip install -r $requirementsTxt",
      "} else {",
      "    Write-Warning 'No requirements.txt found in backend'",
      "}",
      "",
      "deactivate",
      "Write-Host '[INFO] Backend setup completed'",
      "",
      "# 3. Create venv for km (corresponding to setup_and_run.bat 309-346)",
      "Write-Host '[INFO] Setting up km virtual environment...'",
      "$kmPath = Join-Path $dir 'km'",
      "$kmVenv = Join-Path $kmPath 'venv_km'",
      "",
      "if (-not (Test-Path $kmVenv)) {",
      "    Write-Host '[INFO] Virtual environment not found, creating new one...'",
      "    python311 -m venv $kmVenv",
      "    if ($LASTEXITCODE -ne 0) {",
      "        Write-Error 'Failed to create venv_km'",
      "        exit 1",
      "    }",
      "    Write-Host '[INFO] Virtual environment created'",
      "} else {",
      "    Write-Host '[INFO] Virtual environment already exists, will update dependencies'",
      "}",
      "",
      "Write-Host '[INFO] Checking and installing km requirements...'",
      "$kmActivate = Join-Path $kmVenv 'Scripts\\Activate.ps1'",
      "& $kmActivate",
      "",
      "$kmRequirementsTxt = Join-Path $kmPath 'requirements.txt'",
      "",
      "if (Test-Path $kmRequirementsTxt) {",
      "    Write-Host '[INFO] Installing from requirements.txt...'",
      "    pip install -r $kmRequirementsTxt",
      "} else {",
      "    Write-Warning 'No requirements.txt found in km'",
      "}",
      "",
      "deactivate",
      "Write-Host '[INFO] km setup completed'"
    ]
  },
  "pre_uninstall": ["cd \"$dir\"", ".\\stop.ps1"]
}
