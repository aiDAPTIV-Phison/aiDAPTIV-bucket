{
    "version": "0.0.1",
    "description": "Continue - The open-source AI code assistant for VS Code. Continue brings the power of AI to your development workflow with intelligent code completions, explanations, and refactoring suggestions.",
    "homepage": "https://github.com/aiDAPTIV-Phison/aiDAPTIV-Integration-Continue",
    "url": [
        "https://phison-software-bucket.s3.ap-northeast-1.amazonaws.com/aiDAPTIV_Application/Continue/continue-1.2.9.vsix",
        "https://github.com/aiDAPTIV-Phison/aiDAPTIV-bucket/raw/refs/heads/main/continue/start.ps1",
        "https://github.com/aiDAPTIV-Phison/aiDAPTIV-bucket/raw/refs/heads/main/continue/stop.ps1",
        "https://github.com/aiDAPTIV-Phison/aiDAPTIV-bucket/raw/refs/heads/main/continue/status.ps1"
    ],
    "hash": [
        "e556708a09929d9c347d6d8fdc26c7a5cac2ccaa1bce682127077212335069d6",
        "06994ecc0f47b1162c366eebe761e009ea2e030345f4cbb3dae8308672ac27aa",
        "eafff247ca7e92294df6cc42a2ceaa0dffbde206675d04c9691e8fc2befc2c59",
        "1b70388b8922ad477fa6aa2a54d4ddd8bf275bb445cd932df07e8d04b8aa449f"
    ],
    "pre_install": [
        "Write-Host ''",
        "Write-Host '========================================' -ForegroundColor Cyan",
        "Write-Host '[DOWNLOAD & EXTRACT] continue_kvcache.zip' -ForegroundColor Cyan",
        "Write-Host '========================================' -ForegroundColor Cyan",
        "$installDrive = Split-Path -Qualifier $dir",
        "$cacheZipUrl = 'http://192.168.54.46:18301/continue/continue_kvcache.zip'",
        "$cacheZipPath = Join-Path $dir 'continue_kvcache.zip'",
        "$cacheZipHash = '3ce81313d3f33a12c972835db669cbbc93b6f80e5718039e6947a965278c4c6c'",
        "$cacheFolder = Join-Path $dir 'continue_kvcache'",
        "Write-Host \"[INFO] Installation path: $dir\"",
        "Write-Host \"[INFO] Installation drive: $installDrive\"",
        "Write-Host ''",
        "Write-Host '[Step 1/4] Checking remote file size and disk space...'",
        "try {",
        "  $request = [System.Net.HttpWebRequest]::Create($cacheZipUrl)",
        "  $request.Method = 'HEAD'",
        "  $request.Timeout = 10000",
        "  $response = $request.GetResponse()",
        "  $compressedSize = $response.ContentLength",
        "  $response.Close()",
        "  $compressedGB = [math]::Round($compressedSize / 1GB, 2)",
        "  $compressedMB = [math]::Round($compressedSize / 1MB, 2)",
        "  Write-Host \"[INFO] Remote file size: $compressedGB GB ($compressedMB MB)\" -ForegroundColor Green",
        "  $estimatedUncompressed = $compressedSize * 2.5",
        "  $estimatedGB = [math]::Round($estimatedUncompressed / 1GB, 2)",
        "  Write-Host \"[INFO] Estimated uncompressed size: $estimatedGB GB (Ã— 2.5)\" -ForegroundColor Yellow",
        "  $installDriveInfo = Get-PSDrive -Name $installDrive.TrimEnd(':') -ErrorAction SilentlyContinue",
        "  if (-not $installDriveInfo) {",
        "    throw \"Cannot access installation drive ($installDrive) information\"",
        "  }",
        "  $freeSpace = $installDriveInfo.Free",
        "  $freeSpaceGB = [math]::Round($freeSpace / 1GB, 2)",
        "  Write-Host \"[INFO] Installation drive ($installDrive) available: $freeSpaceGB GB\" -ForegroundColor Yellow",
        "  $requiredSpace = $compressedSize + $estimatedUncompressed + ($estimatedUncompressed * 0.2)",
        "  $requiredGB = [math]::Round($requiredSpace / 1GB, 2)",
        "  Write-Host \"[INFO] Required space (download + extract + 20% buffer): $requiredGB GB\" -ForegroundColor Yellow",
        "  if ($freeSpace -lt $requiredSpace) {",
        "    Write-Host '' -ForegroundColor Red",
        "    Write-Host '========================================' -ForegroundColor Red",
        "    Write-Host \"[ERROR] INSUFFICIENT DISK SPACE ON $installDrive\" -ForegroundColor Red",
        "    Write-Host '========================================' -ForegroundColor Red",
        "    Write-Host \"Compressed      : $compressedGB GB\" -ForegroundColor Red",
        "    Write-Host \"Uncompressed    : $estimatedGB GB (estimated)\" -ForegroundColor Red",
        "    Write-Host \"Required total  : $requiredGB GB\" -ForegroundColor Red",
        "    Write-Host \"Available       : $freeSpaceGB GB\" -ForegroundColor Red",
        "    Write-Host \"Shortage        : $([math]::Round(($requiredSpace - $freeSpace) / 1GB, 2)) GB\" -ForegroundColor Red",
        "    Write-Host '' -ForegroundColor Red",
        "    Write-Host \"Please free up at least $([math]::Round(($requiredSpace - $freeSpace) / 1GB, 2)) GB on $installDrive drive.\" -ForegroundColor Red",
        "    Write-Host '========================================' -ForegroundColor Red",
        "    throw \"Insufficient disk space on $installDrive\"",
        "  }",
        "  Write-Host '[SUCCESS] Disk space check PASSED' -ForegroundColor Green",
        "} catch {",
        "  Write-Error \"[ERROR] Pre-check failed: $_\"",
        "  throw $_",
        "}",
        "Write-Host ''",
        "Write-Host '[Step 2/4] Downloading continue_kvcache.zip...'",
        "try {",
        "  if (Test-Path $cacheZipPath) {",
        "    Write-Host '[INFO] Zip file already exists, checking hash...'",
        "    $existingHash = (Get-FileHash -Path $cacheZipPath -Algorithm SHA256).Hash.ToLower()",
        "    if ($existingHash -eq $cacheZipHash) {",
        "      Write-Host '[INFO] Hash matches, skipping download' -ForegroundColor Green",
        "    } else {",
        "      Write-Host '[WARNING] Hash mismatch, re-downloading...' -ForegroundColor Yellow",
        "      Remove-Item -Path $cacheZipPath -Force",
        "      $webClient = New-Object System.Net.WebClient",
        "      $webClient.DownloadFile($cacheZipUrl, $cacheZipPath)",
        "      $webClient.Dispose()",
        "    }",
        "  } else {",
        "    $webClient = New-Object System.Net.WebClient",
        "    $webClient.DownloadFile($cacheZipUrl, $cacheZipPath)",
        "    $webClient.Dispose()",
        "  }",
        "  Write-Host '[SUCCESS] Download completed' -ForegroundColor Green",
        "} catch {",
        "  Write-Error \"[ERROR] Download failed: $_\"",
        "  throw $_",
        "}",
        "Write-Host ''",
        "Write-Host '[Step 3/4] Verifying file integrity (SHA256)...'",
        "try {",
        "  $actualHash = (Get-FileHash -Path $cacheZipPath -Algorithm SHA256).Hash.ToLower()",
        "  Write-Host \"[INFO] Expected: $cacheZipHash\"",
        "  Write-Host \"[INFO] Actual  : $actualHash\"",
        "  if ($actualHash -ne $cacheZipHash) {",
        "    throw \"Hash verification failed! File may be corrupted.\"",
        "  }",
        "  Write-Host '[SUCCESS] Hash verification PASSED' -ForegroundColor Green",
        "} catch {",
        "  Write-Error \"[ERROR] Hash verification failed: $_\"",
        "  if (Test-Path $cacheZipPath) { Remove-Item -Path $cacheZipPath -Force }",
        "  throw $_",
        "}",
        "Write-Host ''",
        "Write-Host '[Step 4/4] Extracting archive...'",
        "try {",
        "  if (Test-Path $cacheFolder) {",
        "    Write-Host '[INFO] Removing existing cache folder...'",
        "    Remove-Item -Path $cacheFolder -Recurse -Force",
        "  }",
        "  Add-Type -AssemblyName System.IO.Compression.FileSystem",
        "  [System.IO.Compression.ZipFile]::ExtractToDirectory($cacheZipPath, $dir)",
        "  if (Test-Path $cacheFolder) {",
        "    $extractedSize = (Get-ChildItem -Path $cacheFolder -Recurse -File | Measure-Object -Property Length -Sum).Sum",
        "    $extractedGB = [math]::Round($extractedSize / 1GB, 2)",
        "    Write-Host \"[INFO] Extracted size: $extractedGB GB\" -ForegroundColor Green",
        "    Write-Host '[SUCCESS] Extraction completed' -ForegroundColor Green",
        "    Write-Host '[INFO] Cleaning up zip file...'",
        "    Remove-Item -Path $cacheZipPath -Force",
        "  } else {",
        "    throw 'Extraction completed but cache folder not found'",
        "  }",
        "} catch {",
        "  Write-Error \"[ERROR] Extraction failed: $_\"",
        "  throw $_",
        "}",
        "Write-Host '========================================' -ForegroundColor Cyan",
        "Write-Host ''",
        "Write-Host '[INFO] Checking for VS Code installation...'",
        "$vscodeCheck = Get-Command code -ErrorAction SilentlyContinue",
        "if (-not $vscodeCheck) {",
        "  Write-Host '[WARNING] VS Code not found, installing via scoop...'",
        "  $bucketsOutput = scoop bucket list 2>&1",
        "  if ($bucketsOutput -notmatch 'extras') {",
        "    Write-Host '[INFO] Adding extras bucket...'",
        "    scoop bucket add extras",
        "    if ($LASTEXITCODE -ne 0) { Write-Error 'Failed to add extras bucket'; exit 1 }",
        "  }",
        "  Write-Host '[INFO] Installing VS Code...'",
        "  scoop install vscode",
        "  if ($LASTEXITCODE -ne 0) { Write-Error 'Failed to install VS Code'; exit 1 }",
        "  Write-Host '[SUCCESS] VS Code installed successfully'",
        "  Write-Host '[INFO] Refreshing PATH environment...'",
        "  $env:Path = [System.Environment]::GetEnvironmentVariable('Path','Machine') + ';' + [System.Environment]::GetEnvironmentVariable('Path','User')",
        "} else {",
        "  Write-Host '[INFO] VS Code is already installed'",
        "  $vscodeVersion = & code --version 2>&1 | Select-Object -First 1",
        "  Write-Host \"[INFO] VS Code version: $vscodeVersion\"",
        "}"
    ],
    "installer": {
        "script": [
            "Write-Host '[INFO] Installing Continue extension...'",
            "$vsixPath = Join-Path $dir 'continue-1.2.9.vsix'",
            "if (-not (Test-Path $vsixPath)) { Write-Error 'VSIX file not found'; exit 1 }",
            "& code --install-extension $vsixPath --force",
            "if ($LASTEXITCODE -ne 0) { Write-Error 'Failed to install Continue extension'; exit 1 }",
            "Write-Host '[SUCCESS] Continue extension installed successfully'"
        ]
    },
    "post_install": [
        "Write-Host '[INFO] Verifying Continue extension installation...'",
        "$extensions = & code --list-extensions 2>&1",
        "if ($extensions -match 'continue') {",
        "  Write-Host '[SUCCESS] Continue extension verified and ready to use'",
        "  Write-Host ''",
        "  Write-Host '========================================' -ForegroundColor Cyan",
        "  Write-Host '[DISK SPACE CHECK] Phase 2: Pre-migration verification' -ForegroundColor Cyan",
        "  Write-Host '========================================' -ForegroundColor Cyan",
        "  $cacheFolder = Join-Path $dir 'continue_kvcache'",
        "  if ((Test-Path 'R:\\inference_phison') -and (Test-Path $cacheFolder)) {",
        "    try {",
        "      Write-Host '[INFO] Re-checking R: drive space before migration...'",
        "      $folderSize = (Get-ChildItem -Path $cacheFolder -Recurse -File -ErrorAction SilentlyContinue | Measure-Object -Property Length -Sum).Sum",
        "      if ($null -eq $folderSize) { $folderSize = 0 }",
        "      $sizeInGB = [math]::Round($folderSize / 1GB, 2)",
        "      $rDrive = Get-PSDrive -Name R -ErrorAction SilentlyContinue",
        "      if ($rDrive) {",
        "        $rFreeSpace = $rDrive.Free",
        "        $rFreeSpaceGB = [math]::Round($rFreeSpace / 1GB, 2)",
        "        $requiredSpace = $folderSize * 1.15",
        "        $requiredGB = [math]::Round($requiredSpace / 1GB, 2)",
        "        Write-Host \"[INFO] Cache size: $sizeInGB GB\"",
        "        Write-Host \"[INFO] R: drive available: $rFreeSpaceGB GB\"",
        "        Write-Host \"[INFO] Required (with buffer): $requiredGB GB\"",
        "        if ($rFreeSpace -lt $requiredSpace) {",
        "          Write-Host '' -ForegroundColor Red",
        "          Write-Host '[ERROR] Insufficient space on R: drive for migration' -ForegroundColor Red",
        "          Write-Host \"[ERROR] Shortage: $([math]::Round(($requiredSpace - $rFreeSpace) / 1GB, 2)) GB\" -ForegroundColor Red",
        "          Write-Warning '[WARNING] Cache will remain in installation directory'",
        "          Write-Host '========================================' -ForegroundColor Cyan",
        "        } else {",
        "          Write-Host '[SUCCESS] Space check passed, starting migration...' -ForegroundColor Green",
        "          Write-Host '========================================' -ForegroundColor Cyan",
        "          Write-Host '[INFO] Moving cache to R:\\inference_phison\\continue_kvcache...'",
        "          Move-Item -Path $cacheFolder -Destination 'R:\\inference_phison\\continue_kvcache' -Force",
        "          if (Test-Path 'R:\\inference_phison\\continue_kvcache') {",
        "            Write-Host '[SUCCESS] Cache successfully migrated to R: drive' -ForegroundColor Green",
        "          } else {",
        "            Write-Warning '[WARNING] Migration completed but verification failed'",
        "          }",
        "        }",
        "      } else {",
        "        Write-Warning '[WARNING] Unable to access R: drive, cache remains in installation directory'",
        "      }",
        "    } catch {",
        "      Write-Warning \"[WARNING] Migration failed: $_\"",
        "      Write-Warning '[WARNING] Cache will remain in installation directory'",
        "    }",
        "  } elseif (-not (Test-Path 'R:\\inference_phison')) {",
        "    Write-Warning '[WARNING] R:\\inference_phison not found, cache remains in installation directory'",
        "  } elseif (-not (Test-Path $cacheFolder)) {",
        "    Write-Warning '[WARNING] Cache folder not found, skipping migration'",
        "  }",
        "  Write-Host ''",
        "  Write-Host '[INFO] You may need to restart VS Code to see the extension'",
        "} else {",
        "  Write-Warning 'Continue extension may not be properly installed. Please run: code --install-extension continue-1.2.9.vsix manually'",
        "}"
    ],
    "pre_uninstall": [
        "if (Test-Path \"$dir\\stop.ps1\") { & \"$dir\\stop.ps1\" | Out-Null; Start-Sleep -Seconds 2 }",
        "if (Test-Path \"$dir\\status.ps1\") { Remove-Item -Path \"$dir\\status.ps1\" -Force -ErrorAction SilentlyContinue }",
        "Write-Host '[INFO] Checking for Continue extension...'",
        "$extensions = & code --list-extensions 2>&1",
        "$continueExt = $extensions | Where-Object { $_ -match 'continue' } | Select-Object -First 1",
        "if ($continueExt) {",
        "  Write-Host \"[INFO] Uninstalling Continue extension: $continueExt\"",
        "  & code --uninstall-extension $continueExt",
        "  if ($LASTEXITCODE -eq 0) {",
        "    Write-Host '[SUCCESS] Continue extension uninstalled'",
        "  } else {",
        "    Write-Warning 'Failed to uninstall Continue extension automatically'",
        "  }",
        "} else {",
        "  Write-Host '[INFO] Continue extension not found, skipping uninstall'",
        "}",
        "Write-Host '[INFO] Removing cache'",
        "if (Test-Path 'R:\\inference_phison\\continue_kvcache') { Remove-Item -Path 'R:\\inference_phison\\continue_kvcache' -Recurse -Force -ErrorAction SilentlyContinue }",
        "Write-Host '[INFO] Remove cache completed'"
    ]
}